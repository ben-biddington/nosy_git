#!/usr/bin/ruby

class Lines
  class << self
    def for(file, revision)
      %x{ git checkout #{revision} #{file} }
      %x{ wc -l #{file} }.match(/^([^\s]+) /)[1]
    end
  end
end

class Revisions
  class << self
    def for(file)
      %x{ git log --oneline -- #{file} }
    end
  end
end

the_file = ARGV[0]

require "fileutils"

puts "(#{FileUtils.pwd})"
puts "Analyzing <#{the_file}>"

revisions = Revisions.for the_file

revisions.each do |rev|
  matches = rev.match /([^\s]+)\s(.+)/

  the_revision = matches[1].strip
  the_commit_message = matches[2].strip

  the_number_of_lines = Lines.for the_file, the_revision
  puts "#{the_revision}, lines: #{the_number_of_lines}, message: #{the_commit_message[0,50]}"
end
