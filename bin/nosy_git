#!/usr/bin/ruby

STDOUT.sync = true

the_file = ARGV[0]

require File.join File.dirname(__FILE__), "..", "lib", "nosy_git"
require "fileutils"

if Git.has_changes?
  puts "You have changes, aborting" 
  exit 1
end

puts "(#{FileUtils.pwd})"
puts "Analyzing <#{the_file}>"

class RevisionText
  def self.print(the_file, rev)
    the_number_of_lines = Lines.for the_file, rev.number

    msg = rev.message.length > 50 ? "#{rev.message[0,50]}..." : rev.message

    "author:#{rev.author.ljust(25)}, #{rev.timestamp} #{rev.number}, lines: #{the_number_of_lines.to_s.ljust(10)}, added: #{rev.changes.added.to_s.ljust(10)}, message: #{msg}"
  end
end

Revisions.for(the_file).each do |rev|
  puts RevisionText.print the_file, rev 
end
